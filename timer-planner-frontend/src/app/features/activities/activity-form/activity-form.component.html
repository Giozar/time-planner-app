<div class="form-container">
  <header>
    <h1>{{ isEditMode ? 'Editar Actividad' : 'Nueva Actividad' }}</h1>
    <p>Define trabajo estructurado y planificable.</p>
  </header>

  <form [formGroup]="activityForm" (ngSubmit)="onSubmit()">

    <div class="form-group">
      <label>Título</label>
      <input type="text" formControlName="title" placeholder="Ej: Redactar Informe Final">
    </div>

    <div class="row">
      <div class="form-group half">
        <label>Tipo</label>
        <select formControlName="type">
          @for (opt of typeOptions; track opt.value) {
          <option [value]="opt.value">{{ opt.label }}</option>
          }
        </select>
      </div>
      <div class="form-group half">
        <label>Nivel</label>
        <select formControlName="level">
          @for (opt of levelOptions; track opt.value) {
          <option [value]="opt.value">{{ opt.label }}</option>
          }
        </select>
      </div>
    </div>

    <div class="form-group">
      <label>Fecha Límite (Deadline) <span class="req">*</span></label>
      <input type="date" formControlName="deadline" [min]="minDate">
    </div>

    <hr class="divider">

    @if (isSimple) {
    <div class="plan-section fade-in">
      <h3>Plan de Ejecución</h3>

      <div class="form-group">
        <label>Duración por Sesión (min)</label>
        <input type="number" formControlName="duration">
      </div>

      <div class="form-group">
        <label>Estrategia</label>
        <div class="radio-group">
          @for (opt of planTypeOptions; track opt.value) {
          <label>
            <input type="radio" formControlName="planType" [value]="opt.value">
            {{ opt.label }}
          </label>
          }
        </div>
      </div>

      @if (isPattern) {
      <div class="form-group pattern-box">
        <label>Selecciona los días:</label>
        <div class="week-grid">
          @for (day of weekDays; track day.value) {
          <label class="day-check">
            <input type="checkbox" [value]="day.value" [checked]="isDayChecked(day.value)"
              (change)="onDayChange($event)">
            <span>{{ day.label }}</span>
          </label>
          }
        </div>
        <p class="hint">Se generarán todas las sesiones automáticamente.</p>
      </div>
      }

      @if (!isPattern) {
      <div class="form-group dates-box">
        <label>Añadir Fecha</label>
        <div class="date-adder">
          <input type="date" #dateInput [min]="minDate">
          <button type="button" (click)="addSpecificDate(dateInput)">+</button>
        </div>

        <div class="selected-dates">
          @for (date of specificDatesArray.value; track $index) {
          <span class="date-tag">
            {{ date }}
            <span class="remove" (click)="removeSpecificDate($index)">×</span>
          </span>
          } @empty {
          <span class="empty-hint">Sin fechas añadidas</span>
          }
        </div>
      </div>
      }
    </div>
    } @else {
    <div class="info-box fade-in">
      <p><strong>Actividad Compuesta:</strong> No defines tiempos ahora. Crearás subactividades (pasos) después, y cada
        paso tendrá su propio plan de ejecución.</p>
    </div>
    }

    <div class="actions">
      <button type="button" class="btn-cancel" (click)="cancel()">Cancelar</button>
      <button type="submit" class="btn-save" [disabled]="activityForm.invalid">
        {{ isEditMode ? 'Guardar Cambios' : 'Crear Actividad' }}
      </button>
    </div>

  </form>
</div>